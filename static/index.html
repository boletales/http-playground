<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>http-playground</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        input[type="text"] { width: 4em; text-align: right; }
        textarea { width: 100%; height: 8em; margin-top: 0.5em; resize: vertical; }
        button { margin: 0 0.5em; }
        .container { display: flex; margin-top: 1em; gap: 1em; }
        .column { flex: 1; }
        .log-area { margin-bottom: 1em; }
        h3 { margin-top: 0.5em; margin-bottom: 0.5em; }
    </style>
</head>
<body>
    <h1>http-playground</h1>
    <div>
        <input type="text" id="count" readonly value="0">
        <button id="add">+1</button>
        <button id="reset">RESET</button>
        <button id="reload">↺</button>
    </div>
    
    <div class="container">
        <div class="column">
            <h3>リクエスト</h3>
            <div class="log-area">
                <h4>ヘッダ</h4>
                <textarea id="req-header" readonly></textarea>
            </div>
            <div class="log-area">
                <h4>ボディ</h4>
                <textarea id="req-body" readonly></textarea>
            </div>
        </div>
        <div class="column">
            <h3>レスポンス</h3>
            <div class="log-area">
                <h4>ヘッダ</h4>
                <textarea id="res-header" readonly></textarea>
            </div>
            <div class="log-area">
                <h4>ボディ</h4>
                <textarea id="res-body" readonly></textarea>
            </div>
        </div>
    </div>
    
    <script>
        async function logRequest(method, url, body) {
            // リクエストの情報を表示
            document.getElementById('req-header').value = `${method} ${url}\nContent-Type: application/json`;
            document.getElementById('req-body').value = body || '';
            
            // レスポンス情報をリセット
            document.getElementById('res-header').value = 'Loading...';
            document.getElementById('res-body').value = '';
            
            try {
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: body ? body : undefined
                });
                const text = await res.text();
                
                // レスポンスの情報を表示
                document.getElementById('res-header').value = `Status: ${res.status} ${res.statusText}\n`;
                Array.from(res.headers.entries()).forEach(([key, value]) => {
                    document.getElementById('res-header').value += `${key}: ${value}\n`;
                });
                
                document.getElementById('res-body').value = text;
                
                // カウント値を更新
                if (res.ok && (url.endsWith('getcount') || url.endsWith('addcount') || url.endsWith('resetcount'))) {
                    try {
                        const json = JSON.parse(text);
                        document.getElementById('count').value = json.value;
                    } catch (e) {
                        console.error('JSON parse error:', e);
                    }
                }
            } catch (e) {
                document.getElementById('res-header').value = 'Error';
                document.getElementById('res-body').value = `${e}`;
            }
        }
        document.getElementById('add').onclick = () => logRequest('POST', '/addcount', JSON.stringify({ value: 1 }));
        document.getElementById('reset').onclick = () => logRequest('PUT', '/resetcount');
        document.getElementById('reload').onclick = () => logRequest('GET', '/getcount');
        window.onload = () => logRequest('GET', '/getcount');
    </script>
</body>
</html>
